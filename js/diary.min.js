var ActiveWeek=0,MaxWeek=0;const MagicDate=new Date(2020,2,29),SearchItems=JSON.parse(getFile("https://liukonen.dev/furlough/keywords.json"));var ActiveWeeks=[],AllWeeks=[];const ContentObserver=new IntersectionObserver((entries,ContentObserver)=>{entries.forEach(entry=>{var item;entry.isIntersecting&&(item=entry.target.getAttribute("data-src").split("|"),entry.target.innerHTML=ExtractBlogItem(item[0],item[1]),ContentObserver.unobserve(entry.target))})},{threshold:1,rootMargin:"0px 0px 0px 0px"});function SearchFind2(){SearchFind(search.value.trim().toLowerCase())}function SearchFind(searchString){var ResponseItem=SearchItems.filter(x=>x.keyword==searchString)[0]||null;null!=ResponseItem&&PopulateSearchResults(ResponseItem.files)}const navTemplate=data=>`<li class="nav-item" id="li-${RmName(data.Name)}"><a class="nav-link" id="btn-${RmName(data.Name)}" onclick="PopulateWeek('${data.Link}', '${data.Name}')">${RmName(data.Name)}</a></li>`,itemTemplate=d=>`<div class="col-md-12">
 <div class="row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow h-md-250 position-relative">
     <div class="col-md-12 p-4 d-flex flex-column position-static">
         <a href="${d.Link}" target="_blank">
             <h3 class="mb-0">${d.Name}</h3>
         </a>
         <div class="mb-1 text-muted">${CalcDate(d.ItemNumber).toDateString()}</div>
         <p class="card-text mb-auto">
             <div class="EItem" data-src="${d.Link}|${d.Name}"></div>
         </p>
     </div>
 </div>
</div>`,innerBind=(template,dataArray,elementName)=>document.getElementById(elementName).insertAdjacentHTML("beforeend",dataArray.map(item=>template(item)).join("")),itemBind=(template,dataArray,activeWeek,elementName)=>document.getElementById(elementName).insertAdjacentHTML("beforeend",dataArray.map(item=>template(item,activeWeek)).join("")),addDays=(date,days)=>new Date(date.getTime()+24*days*60*60*1e3),ReplaceAll=(fullText,replaceText,replaceWith)=>fullText.replace(new RegExp(replaceText,"igm"),replaceWith),RmName=name=>name.replace("Week ",""),furloughDiary="https://liukonen.dev/furlough/index.html",baseUrl=()=>new URL(furloughDiary).protocol+"//"+new URL(furloughDiary).host,searchInput=document.getElementById("search"),searchResults=document.getElementById("searchresults");function PopulateWeek(weekUrl,name){weekUrl=getFile(baseUrl()+weekUrl),document.getElementById("PlaceHolderItem").innerHTML="",ActiveWeek=parseInt(RmName(name)),name=listLinkParser(weekUrl);innerBind(itemTemplate,name.reverse(),"PlaceHolderItem"),BindDynamic(),SetActive(ActiveWeek)}function PopulateSearchResults(SearchResults){var placeholder=document.getElementById("PlaceHolderItem"),placeholder=(ActiveWeek=-1,placeholder.innerHTML="",SearchResults.map(sItem=>({Name:FakeNewName(sItem),Link:`./furlough/days/${sItem.substring(0,sItem.length-2)}html`,ItemNumber:parseInt(sItem.substring(3,5))})));innerBind(itemTemplate,placeholder,"PlaceHolderItem"),BindDynamic(),SetActive(-1)}function generateNavs(){var weeksString=getFile(furloughDiary),weeksString=(AllWeeks=listLinkParser(weeksString),ActiveWeeks=AllWeeks.slice(AllWeeks.length-4),innerBind(navTemplate,ActiveWeeks,"ulNav"),ActiveWeeks[ActiveWeeks.length-1]);document.getElementById("li-"+RmName(weeksString.Name)).className="page-item active",MaxWeek=parseInt(RmName(weeksString.Name)),PopulateWeek(weeksString.Link,weeksString.Name)}function adjustNavs(direction){var length;document.getElementById("ulNav").innerHTML="",ActiveWeeks=0==direction?(direction=ActiveWeeks[0].ItemNumber,AllWeeks.slice((direction=1<=direction-4?direction-4:1)-1,3+direction)):(direction=ActiveWeeks[ActiveWeeks.length-1].ItemNumber,length=MaxWeek<=direction+4?MaxWeek-direction:4,AllWeeks.slice(direction,direction+length)),innerBind(navTemplate,ActiveWeeks,"ulNav"),SetActive(ActiveWeek)}function BindDynamic(){document.querySelectorAll(".EItem").forEach(item=>{ContentObserver.observe(item)})}function FakeNewName(name){return name.replace(/^./,match=>match.toUpperCase()).replace(/(.{3})/,"$1 ")}function SetActive(activeWeek){ActiveWeeks.forEach(item=>{document.querySelector("#btn-"+item.ItemNumber).classList.toggle("active",item.ItemNumber===activeWeek)});var prevButton=document.querySelector("#prev"),nextButton=document.querySelector("#next");prevButton.style.display=1===ActiveWeeks[0].ItemNumber?"none":"block",nextButton.style.display=ActiveWeeks[ActiveWeeks.length-1].ItemNumber===MaxWeek?"none":"block"}function CalcDate(ItemNumber){return addDays(MagicDate,7*ActiveWeek+ItemNumber)}function listLinkParser(file){for(var ulMatch,response=[],ulRegex=/<ul>(.*?)<\/ul>/gs,liRegex=/<a\s+href="(.*?)">(.*?)<\/a>/gs;ulMatch=ulRegex.exec(file);){var[,liContent]=ulMatch;let counter=1;for(;liMatch=liRegex.exec(liContent);){var[,liMatch,text]=liMatch;response.push({Name:text,Link:liMatch,ItemNumber:counter}),counter++}}return response}function ExtractBlogItem(dayUrl){return ExtractBlogItem(dayUrl,"")}function ExtractBlogItem(dayUrl,name){var dayUrl=getFile(baseUrl()+dayUrl.substring(0,dayUrl.length-4)+"md"),teststring=dayUrl.replace("#","").trim(),teststring=teststring.startsWith(name)?teststring.substring(name.length):dayUrl,name=ReplaceAll(teststring,"# ","### ");return marked.parse(name)}function GenerateKeywords(){innerBind(data=>`<li class="list-group-item d-flex justify-content-between align-items-center">
    <a onclick="SearchFind('${data.keyword}')">${data.keyword}</a>
      <span class="badge text-bg-primary">${data.count}</span>
    </li>`,SearchItems.slice(0,5),"ulKeywords")}generateNavs(),GenerateKeywords(),searchInput.addEventListener("input",function(){const val=this.value.toLowerCase();Array.from(searchResults.options).some(option=>option.value.toLowerCase()===val)&&SearchFind(this.value)}),searchInput.addEventListener("keyup",event=>{if("Enter"===event.key)SearchFind2();else{searchResults.innerHTML="";let searchString=searchInput.value.trim().toLowerCase();event=SearchItems.filter(s=>s.keyword.startsWith(searchString)).slice(0,6);innerBind(data=>`<option>${data.keyword}</option>`,event,"searchresults")}});const fileCache={};function getFile(fileUrl){let response="";var cachedFile=sessionStorage.getItem(fileUrl);if(cachedFile)return cachedFile;const xhr=new XMLHttpRequest;return xhr.open("GET",fileUrl,!1),xhr.onload=function(){var data;200===xhr.status?(data=xhr.responseText,sessionStorage.setItem(fileUrl,data),response=data):window.alert(`Failed to load file: ${xhr.status} `+xhr.statusText)},xhr.onerror=function(){window.alert("Network error occurred while loading the file.")},xhr.send(),response}document.getElementById("year").innerHTML=(new Date).getFullYear();