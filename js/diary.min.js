let ActiveWeek=0,MaxWeek=0;const MagicDate=new Date(2020,2,29),SearchItems=JSON.parse(getFile("https://liukonen.dev/furlough/keywords.json"));let ActiveWeeks=[],AllWeeks=[];const ContentObserver=new IntersectionObserver((e,t)=>{for(const n of e)if(n.isIntersecting){const o=n.target.dataset.src.split("|");n.target.innerHTML=ExtractBlogItem(o[0],o[1]),t.unobserve(n.target)}},{threshold:1,rootMargin:"0px 0px 0px 0px"});function SearchFind2(){SearchFind(search.value.trim().toLowerCase())}function SearchFind(e){let t=SearchItems.find(n=>n.keyword==e)[0]||null;t!=null&&PopulateSearchResults(t.files)}const navTemplate=e=>`<li class="nav-item" id="li-${RmName(e.Name)}"><a class="nav-link" id="btn-${RmName(e.Name)}" onclick="PopulateWeek('${e.Link}', '${e.Name}')">${RmName(e.Name)}</a></li>`,itemTemplate=e=>`<div class="col-md-12">
 <div class="row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow h-md-250 position-relative">
     <div class="col-md-12 p-4 d-flex flex-column position-static">
         <a href="${e.Link}" target="_blank">
             <h3 class="mb-0">${e.Name}</h3>
         </a>
         <div class="mb-1 text-muted">${CalcDate(e.ItemNumber).toDateString()}</div>
         <p class="card-text mb-auto">
             <div class="EItem" data-src="${e.Link}|${e.Name}"></div>
         </p>
     </div>
 </div>
</div>`,innerBind=(e,t,n)=>document.getElementById(n).insertAdjacentHTML("beforeend",t.map(s=>e(s)).join("")),addDays=(e,t)=>new Date(e.getTime()+t*24*60*60*1e3),ReplaceAll=(e,t,n)=>e.replaceAll(new RegExp(t,"igm"),n),RmName=e=>e.replace("Week ",""),furloughDiary="https://liukonen.dev/furlough/index.html",baseUrl=()=>`${new URL(furloughDiary).protocol}//${new URL(furloughDiary).host}`,searchInput=document.getElementById("search"),searchResults=document.getElementById("searchresults");generateNavs(),GenerateKeywords();function PopulateWeek(e,t){let n=getFile(baseUrl()+e);const s=document.getElementById("PlaceHolderItem");s.innerHTML="",ActiveWeek=Number.parseInt(RmName(t));let o=listLinkParser(n);innerBind(itemTemplate,o.reverse(),"PlaceHolderItem"),BindDynamic(),SetActive(ActiveWeek)}function PopulateSearchResults(e){const t=document.getElementById("PlaceHolderItem");ActiveWeek=-1,t.innerHTML="";const n=e.map(s=>({Name:FakeNewName(s),Link:`./furlough/days/${s.substring(0,s.length-2)}html`,ItemNumber:Number.parseInt(s.substring(3,5))}));innerBind(itemTemplate,n,"PlaceHolderItem"),BindDynamic(),SetActive(-1)}function generateNavs(){let e=getFile(furloughDiary);AllWeeks=listLinkParser(e),ActiveWeeks=AllWeeks.slice(-4),innerBind(navTemplate,ActiveWeeks,"ulNav");const t=ActiveWeeks.at(-1);document.getElementById("li-"+RmName(t.Name)).className="page-item active",MaxWeek=Number.parseInt(RmName(t.Name)),PopulateWeek(t.Link,t.Name)}function adjustNavs(e){let t=document.getElementById("ulNav");if(t.innerHTML="",e==0){let n=ActiveWeeks[0].ItemNumber,s=Math.max(n-4,1);ActiveWeeks=AllWeeks.slice(s-1,s+3)}else{let n=ActiveWeeks.at(-1).ItemNumber,s=n+4>=MaxWeek?MaxWeek-n:4;ActiveWeeks=AllWeeks.slice(n,n+s)}innerBind(navTemplate,ActiveWeeks,"ulNav"),SetActive(ActiveWeek)}function BindDynamic(){const e=document.querySelectorAll(".EItem");for(const t of e)ContentObserver.observe(t)}function FakeNewName(e){return e.replace(/^./,t=>t.toUpperCase()).replace(/(.{3})/,"$1 ")}function SetActive(e){for(const s of e)document.querySelector("#btn-"+s.ItemNumber).classList.toggle("active",s.ItemNumber===e);const t=document.querySelector("#prev"),n=document.querySelector("#next");t.style.display=ActiveWeeks[0].ItemNumber===1?"none":"block",n.style.display=ActiveWeeks.at(-1).ItemNumber===MaxWeek?"none":"block"}function CalcDate(e){return addDays(MagicDate,ActiveWeek*7+e)}function listLinkParser(e){const t=[],n=/<ul>(.*?)<\/ul>/gs,s=/<a\s+href="(.*?)">(.*?)<\/a>/gs;let o;for(;o=n.exec(e);){const[,r]=o;let l,a=1;for(;l=s.exec(r);){const[,i,c]=l;t.push({Name:c,Link:i,ItemNumber:a}),a++}}return t}function ExtractBlogItem(e,t){const n=getFile(baseUrl()+e.substring(0,e.length-4)+"md"),s=n.replace("#","").trim();let o=s.startsWith(t)?s.substring(t.length):n;const r=ReplaceAll(o,"# ","### ");return marked.parse(r)}function GenerateKeywords(){innerBind(t=>`<li class="list-group-item d-flex justify-content-between align-items-center">
    <a onclick="SearchFind('${t.keyword}')">${t.keyword}</a>
      <span class="badge text-bg-primary">${t.count}</span>
    </li>`,SearchItems.slice(0,5),"ulKeywords")}searchInput.addEventListener("input",function(){const e=this.value.toLowerCase();Array.from(searchResults.options).some(n=>n.value.toLowerCase()===e)&&SearchFind(this.value)}),searchInput.addEventListener("keyup",e=>{if(e.key==="Enter")SearchFind2();else{searchResults.innerHTML="";let t=searchInput.value.trim().toLowerCase();const n=SearchItems.filter(o=>o.keyword.startsWith(t)).slice(0,6);innerBind(o=>`<option>${o.keyword}</option>`,n,"searchresults")}});function getFile(e){let t="";const n=sessionStorage.getItem(e);if(n)return n;const s=new XMLHttpRequest;return s.open("GET",e,!1),s.onload=function(){if(s.status===200){const o=s.responseText;sessionStorage.setItem(e,o),t=o}else globalThis.alert(`Failed to load file: ${s.status} ${s.statusText}`)},s.onerror=function(){globalThis.alert("Network error occurred while loading the file.")},s.send(),t}document.getElementById("year").innerHTML=new Date().getFullYear();
